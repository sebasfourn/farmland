<img class="farm-image" alt="Farm" src="/assets/farm.png" >

<div class="title-div">
  <%= link_to url_for(:back) do %>
    <div class="arrow-div">
      <i class="fa-solid fa-chevron-left fa-lg arrow"></i>
      <h2><%= @farm.name %></h2>
    </div>
  <% end %>
</div>

<p><%= @farm.description %></p>

  <%= simple_form_for ([@order]) do |f|%>
  <h3> Join a carpool </h3>
  <div class="carpool-buttons-container">
      <%# <div class="row"> %>
        <%= f.association :trip, collection: @farm.trips, as: :radio_buttons, label_method: :label_text, :collection_wrapper_class => "carpool-buttons-container", :item_wrapper_class => 'farm-order-radio-buttons radio-button-text'%>
      <%# </div> %>
  </div>
<% @products.where.not(stock: 0).each do |product| %>

    <%= f.simple_fields_for :order_products do |order_product| %>
    <%# order_product.input :product, input_html: { value: "#{product.name.capitalize} - #{product.price} per #{product.unit}"}, disabled: false%>
        <div class="farm-product-field">
        <div class = "farm-product-label">
        <%= order_product.label (product.category == "meat" ? product.name : product.name.pluralize) %>
        <p><%= "$#{product.price}/#{product.unit}" %></p>
        <p><%= "#{product.stock}#{product.unit} available" %></p>
      </div>
    <%= order_product.input :quantity, label: "Quantity (#{product.unit})", collection: 0..product.stock, input_html: {name: "order[order_products][#{product.name}][quantity]" }%>
    <%= order_product.input :product, input_html: {value: product.id, name: "order[order_products][#{product.name}][product_id]" }, as: :hidden %>
    <%= order_product.input :farm, input_html: {value: product.farm.id, name: "farm"}, as: :hidden %>
      </div>
    <div class="carbon-savings">
    <p>You save <%= product.co2_saved >= 1 ? "#{product.co2_saved.round(3)} kg" : "#{(product.co2_saved * 1000).round(0)}g" %> of CO2 per kilogram of <%= product.category == "meat" ? product.name : product.name.pluralize %> by buying direct from the farm!</p></div>
    <% end %>

<% end %>
<div class = "d-flex justify-content-center">
<%= f.button :submit, "Place your order", class: "submit-button"%>
</div>
<%end%>
